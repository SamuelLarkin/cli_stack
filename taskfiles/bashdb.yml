version: "3"

env:
  BIN_DIR: "{{.HOME}}/.local/bin"
  INSTALL_DIR: "{{.HOME}}/.local"

tasks:
  default:
    deps:
      - bashdb

  bashdb:
    desc: >
      The Bash Debugger Project is a source-code debugger for bash that follows
      the gdb command syntax.
    summary: |
      The Bash Debugger Project is a source-code debugger for bash that follows
      the gdb command syntax.

      [bashdb](https://bashdb.sourceforge.net/)
    dir: $HOME/tmp
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://sourceforge.net/projects/bashdb/files/bashdb/$VERSION/bashdb-$VERSION.tar.bz2/download"
      - defer: rm $TARBALL
      - mkdir -p bashdb
      - defer: rm -fr bashdb
      - tar xf $TARBALL -C bashdb --strip-components=1
      - |
        cd bashdb
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make install
    env:
      TARBALL: bashdb.tar.bz2
      VERSION: 5.0-1.1.2
    generates:
      - "{{.BIN_DIR}}/bashdb"
    status:
      - command -v bashdb
