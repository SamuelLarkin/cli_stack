version: "3"

env:
  BASH_COMPLETION_D: "{{.HOME}}/.local/share/bash-completion/completions"
  BIN_DIR: "{{.HOME}}/.local/bin"
  INSTALL_DIR: "{{.HOME}}/.local"

tasks:
  default:
    deps:
      - htop
      - hyperfine
      - jq
      - nvim
      - parallel
      - tig
      - ugrep

  htop:
    desc: >
      htop is a cross-platform interactive process viewer.
    summary: |
      htop is a cross-platform interactive process viewer.

      [htop](https://github.com/htop-dev/htop)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/htop-dev/htop/releases/download/$VERSION/htop-$VERSION.tar.xz"
      - defer: rm $TARBALL
      - tar xf $TARBALL --directory=htop --strip-components=1
      - defer: rm -fr htop
      - |
        cd htop
        ./autogen.sh
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) install
    dir: $HOME/tmp
    env:
      TARBALL: htop.tar.xz
      VERSION: 3.4.1
    generates:
      - "{{.BIN_DIR}}/htop"
    status:
      - command -v htop
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  hyperfine:
    desc: >
      A command-line benchmarking tool.
    summary: |
      A command-line benchmarking tool.

      [hyperfine](https://github.com/sharkdp/hyperfine)

      NOTE: probably already install by `cargo install hyperfine`.
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/sharkdp/hyperfine/releases/download/v$VERSION/hyperfine-v$VERSION-x86_64-unknown-linux-musl.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p hyperfine
      - defer: rm -fr hyperfine
      - tar xf $TARBALL --directory=hyperfine --strip-components=1
      - cp hyperfine/hyperfine "{{.BIN_DIR}}"
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: hyperfine.tar.gz
      VERSION: 1.19.0
    generates:
      - "{{.BIN_DIR}}/hyperfine"
    status:
      - command -v hyperfine

  jq:
    desc: >
      jq is a lightweight and flexible command-line JSON processor.
    summary: |
      jq is a lightweight and flexible command-line JSON processor.

      [jq](https://stedolan.github.io/jq/)
      [jq - doc](https://github.com/stedolan/jq)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output "{{.BIN_DIR}}/jq" \
          "https://github.com/jqlang/jq/releases/latest/download/jq-linux-amd64"
      - chmod u+x "{{.BIN_DIR}}/jq"
    generates:
      - "{{.BIN_DIR}}/jq"
    status:
      - command -v jq

  jq_build:
    desc: >
      jq is a lightweight and flexible command-line JSON processor.
    summary: |
      jq is a lightweight and flexible command-line JSON processor.

      [jq](https://stedolan.github.io/jq/)
      [jq - doc](https://github.com/stedolan/jq)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/jqlang/jq/releases/download/jq-$VERSION/jq-$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p jq-build
      - defer: rm -fr jq-build
      - tar xf $TARBALL --directory=jq-build --strip-components=1
      - |
        cd jq-build
        autoreconf -fi
        ./configure --with-oniguruma=builtin --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) LDFLAGS=-all-static
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: jq.tar.gz
      VERSION: 1.7
    generates:
      - "{{.BIN_DIR}}/jq"
    status:
      - command -v jq
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  nvim:
    desc: >
      Vim-fork focused on extensibility and usability.
    summary: |
      Vim-fork focused on extensibility and usability.

      [neovim](https://github.com/neovim/neovim)
    cmds:
      - git clone --branch $VERSION https://github.com/neovim/neovim.git
      - defer: rm -fr neovim
      - |
        cd neovim/
        \make CMAKE_BUILD_TYPE=Release
        \make install CMAKE_BUILD_TYPE=Release CMAKE_INSTALL_PREFIX={{.INSTALL_DIR}}
    dir: "{{.HOME}}/tmp"
    env:
      VERSION: v0.11.4
    generates:
      - "{{.BIN_DIR}}/nvim"
    status:
      - command -v nvim
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  parallel:
    desc: >
      parallel is a shell tool for executing jobs in parallel using one or more computers.
    summary: |
      parallel is a shell tool for executing jobs in parallel using one or more computers.

      [parallel - GNU parallel](https://www.gnu.org/software/parallel/)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://ftp.gnu.org/gnu/parallel/parallel-latest.tar.bz2"
      - defer: rm $TARBALL
      - mkdir -p parallel
      - defer: rm -fr parallel
      - tar xf $TARBALL --directory=parallel --strip-components=1
      - |
        cd parallel
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: parallel.tar.bz2
    generates:
      - "{{.BIN_DIR}}/parallel"
    status:
      - command -v parallel
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  tig:
    desc: >
      Text-mode interface for git
    summary: |
      Text-mode interface for git

      [tig](https://github.com/jonas/tig)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/jonas/tig/releases/download/tig-$VERSION/tig-$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p tig
      - defer: rm -fr tig
      - tar xf $TARBALL --directory=tig --strip-components=1
      - |
        cd tig
        ./autogen.sh
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) install
        mkdir -p {{.BASH_COMPLETION_D}}
        cp contrib/tig-completion.bash {{.BASH_COMPLETION_D}}/tig
        chmod a-x {{.BASH_COMPLETION_D}}/tig
        mkdir -p $CONFIG_DIR
        cp contrib/chocolate.theme.tigrc $CONFIG_DIR
      - |
        curl \
          --create-dirs --fail --location \
          --output $CONFIG_DIR/"#1" \
          'https://raw.githubusercontent.com/h3xx/tig-colors-neonwolf/main/{tig-colors-neonwolf-256.tigrc}'
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: tig.tar.gz
      CONFIG_DIR: "{{.HOME}}/.config/tig"
      VERSION: 2.6.0
    generates:
      - "{{.BIN_DIR}}/bin/tig"
    status:
      - command -v tig
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  ugrep:
    desc: >
      Search for anything in everything... ultra fast.
    summary: |
      Search for anything in everything... ultra fast.

      [ug/ugrep](https://github.com/Genivia/ugrep)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/Genivia/ugrep/archive/refs/tags/v$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p ugrep
      - defer: rm -fr ugrep
      - tar xf $TARBALL --directory=ugrep --strip-components=1
      - |
        cd ugrep
        ./configure --prefix="{{.INSTALL_DIR}}" --without-zstd
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: ugrep.tar.gz
      VERSION: 7.5.0
    generates:
      - "{{.BIN_DIR}}/ugrep"
    status:
      - command -v ugrep
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make
