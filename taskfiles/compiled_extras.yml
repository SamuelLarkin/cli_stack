version: "3"

env:
  BIN_DIR: "{{.HOME}}/.local/bin"
  INSTALL_DIR: "{{.HOME}}/.local"

tasks:
  default:
    deps:
      - gh
      - ncdu

  gh:
    desc: >
      GitHub CLI tools.
    summary: |
      [Install from Source](https://github.com/cli/cli/blob/trunk/docs/source.md)
    cmds:
      - git clone https://github.com/cli/cli.git gh-cli
      - defer: rm -fr gh-cli
      - |
        cd gh-cli
        \make install prefix={{.INSTALL_DIR}}
    dir: "{{.HOME}}/tmp"
    generates:
      - "{{.INSTALL_DIR}}/bin/gh"
    status:
      - which gh
    preconditions:
      - msg: "make must be in your $PATH"
        sh: which make

  ncdu:
    desc: >
      NCurses Disk Usage.
    summary: |
      NCurses Disk Usage.

      [ncdu](https://dev.yorhel.nl/ncdu)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --no-check-certificate \
          --output $TARBALL \
          "https://dev.yorhel.nl/download/ncdu-$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p ncdu
      - defer: rm -fr ncdu
      - tar xf $TARBALL -C ncdu --strip-components=1
      - |
        cd ncdu
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) install
    env:
      TARBALL: ncdu.tar.gz
      VERSION: 1.16
    dir: "{{.HOME}}/tmp"
    generates:
      - "{{.INSTALL_DIR}}/bin/ncdu"
    status:
      - which ncdu
    preconditions:
      - msg: "make must be in your $PATH"
        sh: which make
