version: "3"

env:
  BIN_DIR: "{{.HOME}}/.local/bin"
  INSTALL_DIR: "{{.HOME}}/.local"

tasks:
  default:
    deps:
      - ctags
      - duf
      - gh
      - jo
      - lunarvim
      - pv
      - vifm

  ctags:
    desc: >
      A maintained ctags implementation
    summary: |
      A maintained ctags implementation

      [ctags](https://github.com/universal-ctags/ctags)
    cmds:
      - git clone --branch=v6.0.0 https://github.com/universal-ctags/ctags.git
      - defer: rm -fr ctags
      - |
        cd ctags
        ./autogen.sh
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc)
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      VERSION: v6.0.0
    generates:
      - "{{.BIN_DIR}}/ctags"
    status:
      - command -v ctags
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  duf:
    desc: >
      Disk Usage/Free Utility (Linux, BSD, macOS & Windows).
      NOTE: use go_extras:duf
    summary: |
      NOTE: use go_extras:duf
      Disk Usage/Free Utility (Linux, BSD, macOS & Windows).

      [duf](https://github.com/muesli/duf):
    cmds:
      - git clone https://github.com/muesli/duf.git
      - defer: rm -fr duf
      - |
        cd duf
        go build
        install --mode=u=rx duf {{.BIN_DIR}}
    dir: "{{.HOME}}/tmp"
    generates:
      - "{{.BIN_DIR}}/duf"
    status:
      - command -v duf
    preconditions:
      - msg: "Go must be in your $PATH"
        sh: command -v go

  gh:
    desc: >
      GitHubâ€™s official command line tool.
    summary: |
      GitHubâ€™s official command line tool.

      [gh](https://github.com/cli/cli)
    cmds:
      - git clone https://github.com/cli/cli.git gh-cli
      - defer: rm -fr gh-cli
      - |
        cd gh-cli
        make install prefix={{.INSTALL_DIR}}
    dir: "{{.HOME}}/tmp"
    generates:
      - "{{.BIN_DIR}}/gh"
    status:
      - command -v gh
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  jo:
    desc: >
      JSON output from a shell.
    summary: |
      JSON output from a shell.

      [jo](https://github.com/jpmens/jo)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/jpmens/jo/releases/download/$VERSION/jo-$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p jo
      - defer: rm -fr jo
      - tar xf $TARBALL --directory=jo --strip-components=1
      - |
        cd jo
        autoreconf -i
        ./configure
        \make check
        \make DESTDIR="{{.INSTALL_DIR}}" install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: jo.tar.gz
      VERSION: 1.9
    generates:
      - "{{.BIN_DIR}}/jo"
    status:
      - command -v jo
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  lunarvim:
    desc: >
      ðŸŒ™ LunarVim is an IDE layer for Neovim. Completely free and community
      driven.
    summary: |
      ðŸŒ™ LunarVim is an IDE layer for Neovim. Completely free and community
      driven.

      [LunarVim](https://github.com/LunarVim/LunarVim)
    cmd: bash <(curl -s https://raw.githubusercontent.com/lunarvim/lunarvim/master/utils/installer/install.sh)
    env:
      LV_BRANCH: "release-1.2/neovim-0.8"
    generates:
      - "{{.BIN_DIR}}/lvim"
    status:
      - command -v lvim

  nvim.alternate:
    desc: >
      Vim-fork focused on extensibility and usability.
    summary: |
      Vim-fork focused on extensibility and usability.

      [neovim](https://github.com/neovim/neovim)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output "{{.BIN_DIR}}/nvim" \
          "https://github.com/neovim/neovim/releases/download/v0.9.5/nvim.appimage"
      - chmod u+x "{{.BIN_DIR}}/nvim"
    generates:
      - "{{.BIN_DIR}}/nvim"
    status:
      - command -v nvim

  pv:
    desc: >
      a terminal-based tool for monitoring the progress of data through a
      pipeline.
    summary: |
      a terminal-based tool for monitoring the progress of data through a
      pipeline.

      [pv](https://github.com/a-j-wood/pv)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "http://www.ivarch.com/programs/sources/pv-$VERSION.tar.bz2"
      - defer: rm $TARBALL
      - mkdir -p pv
      - defer: rm -fr pv
      - tar xf $TARBALL --directory=pv --strip-components=1
      - |
        cd pv
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: pv.tar.bz2
      VERSION: 1.6.20
    generates:
      - "{{.BIN_DIR}}/jq"
    status:
      - command -v pv
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make

  vifm:
    desc: >
      Vim-like file manager.
    summary: |
      Vim-like file manager.

      [vifm](https://github.com/vifm/vifm)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://github.com/vifm/vifm/archive/refs/tags/v$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p vifm
      - defer: rm -fr vifm
      - tar xf $TARBALL --directory=vifm --strip-components=1
      - |
        cd vifm
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: vifm.tar.gz
      VERSION: 0.12
    generates:
      - "{{.BIN_DIR}}/vifm"
    status:
      - command -v vifm
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make
