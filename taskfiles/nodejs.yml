version: "3"

env:
  BIN_DIR: "{{.HOME}}/.local/bin"
  INSTALL_DIR: "{{.HOME}}/.local"

tasks:
  default:
    deps:
      - nodejs

  nodejs:
    desc: >
      Node.js速 is an open-source, cross-platform JavaScript runtime
      environment.
    summary: |
      Node.js速 is an open-source, cross-platform JavaScript runtime
      environment.

      [Node.js](https://nodejs.org/en)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://nodejs.org/dist/$VERSION/node-$VERSION-linux-x64.tar.xz"
      - defer: rm $TARBALL
      - tar xf $TARBALL --strip-components=1 --directory={{.INSTALL_DIR}}
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: nodejs.tar.gz
      VERSION: v24.13.0
    generates:
      - "{{.BIN_DIR}}/node"
      - "{{.BIN_DIR}}/npm"
    status:
      - command -v npm
      - command -v node

  nodejs_compiled:
    aliases:
      - npm
    desc: >
      Node.js速 is an open-source, cross-platform JavaScript runtime
      environment.
    summary: |
      Node.js速 is an open-source, cross-platform JavaScript runtime
      environment.

      [Node.js](https://nodejs.org/en)
    cmds:
      - |
        curl \
          --create-dirs --fail --location \
          --output $TARBALL \
          "https://nodejs.org/dist/$VERSION/node-$VERSION.tar.gz"
      - defer: rm $TARBALL
      - mkdir -p nodejs
      - defer: rm -fr nodejs
      - tar xf $TARBALL --directory=nodejs --strip-components=1
      - |
        cd nodejs
        ./configure --prefix="{{.INSTALL_DIR}}"
        \make -j $(nproc)
        \make -j $(nproc) install
    dir: "{{.HOME}}/tmp"
    env:
      TARBALL: nodejs.tar.gz
      VERSION: v24.13.0
    generates:
      - "{{.BIN_DIR}}/node"
      - "{{.BIN_DIR}}/npm"
    status:
      - command -v npm
    preconditions:
      - msg: "make must be in your $PATH"
        sh: command -v make
